<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} | {{ site.title }}</title>
  <!-- Set default theme to dark -->
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#0f172a">
  {%- seo -%}
  <!-- Tailwind CSS CDN for rapid prototyping -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fira+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* Remove background colors from paragraphs */
    article p, .prose p, main p {
      background-color: transparent !important;
      padding: 0 !important;
      margin-bottom: 1.5rem;
      color: #1f2937 !important;
    }
    
    .dark article p, .dark .prose p, .dark main p {
      color: #e5e7eb !important;
    }
    
    /* Fix list items in light theme */
    article li, .prose li, main li {
      color: #1f2937 !important;
      background: transparent !important;
    }
    
    .dark article li, .dark .prose li, .dark main li {
      color: #e5e7eb !important;
    }
    
    /* Fix for text highlight in light mode */
    html:not(.dark) p {
      background: none !important;
      box-shadow: none !important;
    }
    
    /* Fix list highlighting in light mode */
    html:not(.dark) ul, 
    html:not(.dark) ol,
    html:not(.dark) li,
    html:not(.dark) li::marker {
      background: transparent !important;
      color: #1f2937 !important;
    }
    
    /* Custom styles for H1 elements */
    article h1 {
      font-size: 3rem !important;
      font-weight: 800 !important;
      margin-top: 2.5rem !important;
      margin-bottom: 2rem !important;
      padding-left: 1rem !important;
      padding-top: 1rem !important;
      padding-bottom: 1rem !important;
      border-left: 8px solid #2563eb !important;
      background-color: rgba(243, 244, 246, 0.7) !important;
      border-radius: 0 0.375rem 0.375rem 0 !important;
      line-height: 1.2 !important;
    }
    
    .dark article h1 {
      border-left-color: #3b82f6 !important;
      background-color: rgba(31, 41, 55, 0.5) !important;
      color: #f3f4f6 !important;
    }

    /* Make headings more distinct in general */
    article h2 {
      font-size: 1.5rem !important;
      border-bottom: 1px solid #e5e7eb !important;
      padding-bottom: 0.5rem !important;
      margin-top: 2rem !important;
      margin-bottom: 1rem !important;
    }

    .dark article h2 {
      border-bottom-color: #374151 !important;
    }

    article h3 {
      font-size: 1.875rem !important;
      margin-top: 2rem !important;
      margin-bottom: 1rem !important;
    }

    article h4 {
      font-size: 1.5rem !important;
      margin-top: 1.5rem !important;
      margin-bottom: 0.75rem !important;
    }

    /* Improved code block styling for dark mode */
    .dark .prose pre,
    .dark pre,
    .dark .prose code,
    .dark code {
      background-color: #0f172a !important;
      border: 1px solid #374151 !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
    }
    
    /* Code highlighting styles */
    .highlight .c { color: #6b7280; } /* Comment */
    .highlight .k { color: #8b5cf6; font-weight: bold; } /* Keyword */
    .highlight .o { color: #0ea5e9; } /* Operator */
    .highlight .s { color: #10b981; } /* String */
    .highlight .n { color: #1f2937; } /* Name */
    
    /* Dark mode code highlighting */
    .dark .highlight .c { color: #9ca3af; } /* Comment in dark mode */
    .dark .highlight .k { color: #a78bfa; font-weight: bold; } /* Keyword in dark mode */
    .dark .highlight .o { color: #38bdf8; } /* Operator in dark mode */
    .dark .highlight .s { color: #34d399; } /* String in dark mode */
    .dark .highlight .n { color: #e5e7eb; } /* Name in dark mode */
    
    /* Special styling for inline code blocks like plan.md and todo.md */
    code.language-md, code.language-todo {
      font-family: 'Fira Mono', monospace;
      line-height: 1.5;
      font-size: 0.95em;
      padding: 0.2em 0.4em;
    }
    
    /* Make code blocks display language labels */
    .highlight pre {
      position: relative;
      padding-top: 1.5rem;
    }
    
    .highlight pre.language-md:before,
    .highlight pre.language-todo:before {
      content: attr(data-lang);
      position: absolute;
      top: 0;
      right: 0;
      padding: 0.2em 0.5em;
      font-size: 0.75em;
      background: #e5e7eb;
      color: #4b5563;
      border-radius: 0 0 0 4px;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
    }
    
    .dark .highlight pre.language-md:before,
    .dark .highlight pre.language-todo:before {
      background: #374151;
      color: #e5e7eb;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col dark:bg-gray-900 dark:text-gray-100 bg-gray-50">
  <header class="bg-gray-950 text-white border-b border-gray-800">
    <div class="container mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <h1 class="m-0 text-2xl font-extrabold text-white"><a href="{{ '/' | relative_url }}" class="no-underline text-white hover:text-blue-400 transition">{{ site.title }}</a></h1>
      
      <!-- Mobile menu button -->
      <button class="md:hidden flex items-center px-3 py-2 rounded text-gray-100 hover:text-white hover:bg-gray-800" id="mobileMenuBtn">
        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      
      <!-- Desktop navigation -->
      <nav class="hidden md:flex items-center gap-4">
        <a href="{{ site.baseurl }}/" class="text-blue-400 font-semibold hover:text-blue-300 transition">Home</a>
        <a href="{{ site.baseurl }}/articles/" class="text-blue-400 font-semibold hover:text-blue-300 transition">Articles</a>
        <a href="{{ site.baseurl }}/about/" class="text-blue-400 font-semibold hover:text-blue-300 transition">About Me</a>
        <button id="darkModeToggle" class="ml-4 px-3 py-1 rounded bg-gray-800 hover:bg-gray-700 text-gray-100 font-semibold transition">☀️</button>
      </nav>
    </div>
    
    <!-- Mobile menu -->
    <div class="md:hidden hidden transition-all duration-300 ease-in-out" id="mobileMenu">
      <div class="px-4 pt-2 pb-4 space-y-2 bg-gray-900 shadow-lg">
        <a href="{{ site.baseurl }}/" class="block px-3 py-2 rounded-md text-base font-semibold text-blue-400 hover:bg-gray-800">Home</a>
        <a href="{{ site.baseurl }}/articles/" class="block px-3 py-2 rounded-md text-base font-semibold text-blue-400 hover:bg-gray-800">Articles</a>
        <a href="{{ site.baseurl }}/about/" class="block px-3 py-2 rounded-md text-base font-semibold text-blue-400 hover:bg-gray-800">About Me</a>
        <div class="block px-3 py-2 rounded-md">
          <button id="darkModeToggleMobile" class="px-3 py-1 rounded bg-gray-800 hover:bg-gray-700 text-gray-100 font-semibold transition">☀️</button>
        </div>
      </div>
    </div>
  </header>
  
  <main class="flex-1 w-full mx-auto my-8 px-4">
    {{ content }}
  </main>
  
  <footer class="bg-gray-950 border-t border-gray-800 text-center text-gray-400 text-sm py-6 mt-auto">
    <div class="container mx-auto max-w-6xl px-4">
      <p>&copy; 2024 Ivan Stankevichus. Blog content licensed under CC BY-NC-ND 4.0. Code samples under Apache 2.0.</p>
    </div>
  </footer>
  
  <script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Dark mode toggle logic
      const toggle = document.getElementById('darkModeToggle');
      const toggleMobile = document.getElementById('darkModeToggleMobile');
      
      function setDarkMode(on) {
        // Force a complete refresh by toggling class on html element directly
        const htmlElement = document.documentElement;
        
        if (on) {
          // Apply dark mode
          htmlElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
          
          // Explicitly set dark mode on all article cards and containers
          document.querySelectorAll('.article-card, main, article, .prose').forEach(el => {
            if (el.classList.contains('bg-white')) {
              el.classList.remove('bg-white');
              el.classList.add('bg-gray-900');
            }
            
            if (el.classList.contains('text-gray-900')) {
              el.classList.remove('text-gray-900');
              el.classList.add('text-gray-100');
            }
          });
          
          // Update toggle buttons
          if (toggle) toggle.textContent = '☀️';
          if (toggleMobile) toggleMobile.textContent = '☀️';
          
          // Force refresh for elements that might not respond to the class change
          document.body.classList.add('force-dark');
          setTimeout(() => document.body.classList.remove('force-dark'), 100);
        } else {
          // Remove dark mode
          htmlElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
          
          // Explicitly set light mode on all article cards and containers
          document.querySelectorAll('.article-card, main, article, .prose').forEach(el => {
            if (el.classList.contains('bg-gray-900')) {
              el.classList.remove('bg-gray-900');
              el.classList.add('bg-white');
            }
            
            if (el.classList.contains('text-gray-100')) {
              el.classList.remove('text-gray-100');
              el.classList.add('text-gray-900');
            }
          });
          
          // Special handling for article content
          document.querySelectorAll('article').forEach(article => {
            article.classList.remove('dark:bg-gray-800');
            article.classList.add('bg-white');
          });
          
          // Update toggle buttons
          if (toggle) toggle.textContent = '🌙';
          if (toggleMobile) toggleMobile.textContent = '🌙';
          
          // Force refresh for elements that might not respond to the class change
          document.body.classList.add('force-light');
          setTimeout(() => document.body.classList.remove('force-light'), 100);
        }
        
        // Output current mode to console for debugging
        console.log('Theme switched to:', on ? 'dark' : 'light');
        console.log('HTML class list:', htmlElement.classList.contains('dark') ? 'contains dark' : 'no dark class');
      }
      
      // Initial mode - with more robust detection but defaulting to dark
      function detectInitialMode() {
        const userPref = localStorage.getItem('theme');
        const systemPref = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        // Default to dark mode if no preference is set
        const isDark = userPref === 'light' ? false : userPref === 'dark' ? true : true;
        
        // Apply initial mode immediately and directly
        if (isDark) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
        
        // Then fully initialize with our complete function
        setDarkMode(isDark);
      }
      
      // Detect and apply initial mode
      detectInitialMode();
      
      // Add robust event listeners
      if (toggle) {
        toggle.addEventListener('click', function() {
          setDarkMode(!document.documentElement.classList.contains('dark'));
        });
      }
      
      if (toggleMobile) {
        toggleMobile.addEventListener('click', function() {
          setDarkMode(!document.documentElement.classList.contains('dark'));
        });
      }
      
      // Listen for system theme changes too, but respect user preference if set
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (localStorage.getItem('theme') === null) {
          setDarkMode(e.matches);
        }
      });
      
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      
      if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // Add language labels to code blocks
      document.querySelectorAll('pre').forEach(pre => {
        const codeElement = pre.querySelector('code');
        if (codeElement) {
          const classes = codeElement.className.split(' ');
          const langClass = classes.find(cl => cl.startsWith('language-'));
          
          if (langClass) {
            const lang = langClass.replace('language-', '');
            pre.setAttribute('data-lang', lang);
          }
        }
      });
    });
  </script>
</body>
</html> 